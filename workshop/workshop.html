<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title><code>too-many-cells</code> Workshop</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Gregory W. Schwartz" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title"><code>too-many-cells</code> Workshop</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org973f0c8">Install <code>too-many-cells</code></a>
<ul>
<li><a href="#orgab0a054">Install <code>too-many-cells</code></a></li>
<li><a href="#org31ec019">Adding to path (with stack installation)</a></li>
<li><a href="#orgdd6492d">Testing the installation</a></li>
</ul>
</li>
<li><a href="#org1e7db3c">Data download</a>
<ul>
<li><a href="#orgfd6d48b">Download brain data</a></li>
<li><a href="#orgd860963">Download heart data</a></li>
</ul>
</li>
<li><a href="#org9f4c122">Prevent overlapping</a>
<ul>
<li><a href="#orga4a5f32">Backup barcodes</a></li>
<li><a href="#orgb11a97a">Edit barcodes</a></li>
</ul>
</li>
<li><a href="#org0f8cd87">Tree creation with <code>too-many-cells</code></a>
<ul>
<li><a href="#org53a2bcf">Initial tree creation</a></li>
</ul>
</li>
<li><a href="#org35c5e56">Coloring the <code>too-many-cells</code> tree.</a>
<ul>
<li><a href="#org931863f">Prepare labels file</a></li>
<li><a href="#org8e20796">Color tree</a></li>
<li><a href="#org0e7eddc">Custom colors</a></li>
</ul>
</li>
<li><a href="#orgefc28f1">Getting more information from the tree</a>
<ul>
<li><a href="#org7b378e1">Overlay modularity</a></li>
</ul>
</li>
<li><a href="#orga67531e">Pruning the tree</a>
<ul>
<li><a href="#org6db3761">Prune tree by size</a></li>
<li><a href="#org5c3efd0">Prune tree by size distribution</a></li>
</ul>
</li>
<li><a href="#orgbe71bb6">Gene expression</a>
<ul>
<li><a href="#org5557f30">Neuron marker overlay</a></li>
<li><a href="#orgabae537">Increasing visibility</a></li>
<li><a href="#org3a211fc">Gene symbol rather than Ensembl</a></li>
<li><a href="#org54d340d">Heart marker overlay</a></li>
<li><a href="#orga0507ff">Multiple gene expression overlays</a></li>
<li><a href="#org620b908">Custom colors for multiple expression overlays</a></li>
</ul>
</li>
<li><a href="#org9e14968">Differential expression</a>
<ul>
<li><a href="#org0c9a4af">Overlay node numbers</a></li>
<li><a href="#org5756f7d">Differential expression for two nodes</a></li>
<li><a href="#org0372f11">Differential expression for two groups of nodes</a></li>
<li><a href="#orgd23bf2f">Label-filtered differential expression</a></li>
<li><a href="#org44ad1cc">Gene distribution plots</a></li>
<li><a href="#orga57d425">All to all!</a></li>
<li><a href="#orgbac3614">More to discover</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
This is an instructional example of using <code>too-many-cells</code> meant to demonstrate
typical usage, originally presented in the IFI Advanced Computational Biology
Club.
</p>

<p>
For more information about <code>too-many-cells</code>:
</p>

<p>
<a href="https://gregoryschwartz.github.io/too-many-cells/">Website</a>
</p>

<p>
See <a href="https://github.com/GregorySchwartz/too-many-cells">https://github.com/GregorySchwartz/too-many-cells</a> for latest version.
</p>

<p>
See <a href="https://doi.org/10.1038/s41592-020-0748-5">the publication</a> (and please cite!) for more information about the algorithm.
</p>

<div id="outline-container-org973f0c8" class="outline-2">
<h2 id="org973f0c8">Install <code>too-many-cells</code></h2>
<div class="outline-text-2" id="text-org973f0c8">
</div>
<div id="outline-container-orgab0a054" class="outline-3">
<h3 id="orgab0a054">Install <code>too-many-cells</code></h3>
<div class="outline-text-3" id="text-orgab0a054">
<p>
Follow instructions on <a href="https://gregoryschwartz.github.io/too-many-cells/">https://gregoryschwartz.github.io/too-many-cells/</a> for
details. First, clone the <code>too-many-cells</code> repository.
</p>

<div class="org-src-container">
<pre class="src src-sh">git clone https://github.com/GregorySchwartz/too-many-cells.git
</pre>
</div>

<p>
Enter the folder and install with <a href="https://nixos.org/nix/">nix</a>.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ff8700;">cd</span> ./too-many-cells
nix-env -f default.nix -i too-many-cells
</pre>
</div>
</div>
</div>

<div id="outline-container-org31ec019" class="outline-3">
<h3 id="org31ec019">Adding to path (with stack installation)</h3>
<div class="outline-text-3" id="text-org31ec019">
<p>
If using stack, the resulting binary will install to <code>~/.local/bin</code>. Add to
<code>$PATH</code> so you can invoke the command from anywhere!
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #ff8700;">export</span> <span style="color: #87afaf;">PATH</span>=$<span style="color: #87afaf;">HOME</span>/.local/bin:$<span style="color: #87afaf;">PATH</span>
</pre>
</div>

<p>
This command will only work in the current shell. To permanently add to path,
add the previous line to <code>~/.bashrc</code> or <code>~/.profile</code>.
</p>
</div>
</div>

<div id="outline-container-orgdd6492d" class="outline-3">
<h3 id="orgdd6492d">Testing the installation</h3>
<div class="outline-text-3" id="text-orgdd6492d">
<p>
Test to see if the installation worked when in path:
</p>

<div class="org-src-container">
<pre class="src src-sh">too-many-cells -h
</pre>
</div>

<pre class="example" id="org6814341">
too-many-cells, Gregory W. Schwartz. Clusters and analyzes single cell data.

Usage: too-many-cells (make-tree | interactive | differential | diversity |
                      paths | classify | peaks | motifs | matrix-output)

Available options:
  -h,--help                Show this help text

Available commands:
  make-tree                
  interactive              
  differential             
  diversity                
  paths                    
  classify                 
  peaks                    
  motifs                   
  matrix-output 
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e7db3c" class="outline-2">
<h2 id="org1e7db3c">Data download</h2>
<div class="outline-text-2" id="text-org1e7db3c">
</div>
<div id="outline-container-orgfd6d48b" class="outline-3">
<h3 id="orgfd6d48b">Download brain data</h3>
<div class="outline-text-3" id="text-orgfd6d48b">
<p>
We'll need data from 10x. Let's cluster mouse brain and heart cells from
<a href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.0/neuron_1k_v3">https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.0/neuron_1k_v3</a>
and
<a href="https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.0/heart_1k_v3">https://support.10xgenomics.com/single-cell-gene-expression/datasets/3.0.0/heart_1k_v3</a>
as a quick, illustrative example here. <b>Note</b>: these are modern formats of
<code>cellranger</code> outputs (<code>v3</code>), but <code>too-many-cells</code> works with both older and
newer formats.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #767676;"># </span><span style="color: #767676;">Make the data directory</span>
mkdir -p data/brain

<span style="color: #767676;"># </span><span style="color: #767676;">Enter the directory</span>
<span style="color: #ff8700;">cd</span> ./data/brain

<span style="color: #767676;"># </span><span style="color: #767676;">Download the data</span>
wget http://cf.10xgenomics.com/samples/cell-exp/3.0.0/neuron_1k_v3/neuron_1k_v3_filtered_feature_bc_matrix.tar.gz

<span style="color: #767676;"># </span><span style="color: #767676;">Uncompress data</span>
tar xvf neuron_1k_v3_filtered_feature_bc_matrix.tar.gz
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">filtered_feature_bc_matrix/</td>
</tr>

<tr>
<td class="org-left">filtered_feature_bc_matrix/features.tsv.gz</td>
</tr>

<tr>
<td class="org-left">filtered_feature_bc_matrix/matrix.mtx.gz</td>
</tr>

<tr>
<td class="org-left">filtered_feature_bc_matrix/barcodes.tsv.gz</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgd860963" class="outline-3">
<h3 id="orgd860963">Download heart data</h3>
<div class="outline-text-3" id="text-orgd860963">
<p>
Let's do the same for the heart cells:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #767676;"># </span><span style="color: #767676;">Make the data directory</span>
mkdir -p data/heart

<span style="color: #767676;"># </span><span style="color: #767676;">Enter the directory</span>
<span style="color: #ff8700;">cd</span> ./data/heart

<span style="color: #767676;"># </span><span style="color: #767676;">Download the data</span>
wget http://cf.10xgenomics.com/samples/cell-exp/3.0.0/heart_1k_v3/heart_1k_v3_filtered_feature_bc_matrix.tar.gz

<span style="color: #767676;"># </span><span style="color: #767676;">Uncompress data</span>
tar xvf heart_1k_v3_filtered_feature_bc_matrix.tar.gz
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">filtered_feature_bc_matrix/</td>
</tr>

<tr>
<td class="org-left">filtered_feature_bc_matrix/features.tsv.gz</td>
</tr>

<tr>
<td class="org-left">filtered_feature_bc_matrix/barcodes.tsv.gz</td>
</tr>

<tr>
<td class="org-left">filtered_feature_bc_matrix/matrix.mtx.gz</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-org9f4c122" class="outline-2">
<h2 id="org9f4c122">Prevent overlapping</h2>
<div class="outline-text-2" id="text-org9f4c122">
</div>
<div id="outline-container-orga4a5f32" class="outline-3">
<h3 id="orga4a5f32">Backup barcodes</h3>
<div class="outline-text-3" id="text-orga4a5f32">
<p>
These matrices both use <code>BARCODE-1</code> as their cell identifiers. If aggregating
with <code>cellranger</code> this won't be an issue, but because we aren't doing that let's
make sure there are no conflicts. First, let's backup our barcodes as we will be
making changes to ensure no overlapping.
</p>

<div class="org-src-container">
<pre class="src src-shell">cp ./data/brain/filtered_feature_bc_matrix/barcodes.tsv<span style="color: #008787;">{</span>.gz,.gz.bk<span style="color: #008787;">}</span>
cp ./data/heart/filtered_feature_bc_matrix/barcodes.tsv<span style="color: #008787;">{</span>.gz,.gz.bk<span style="color: #008787;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb11a97a" class="outline-3">
<h3 id="orgb11a97a">Edit barcodes</h3>
<div class="outline-text-3" id="text-orgb11a97a">
<p>
Now let's edit the heart barcodes to have <code>-2</code> instead of <code>-1</code>.
</p>

<div class="org-src-container">
<pre class="src src-shell">cat ./data/heart/filtered_feature_bc_matrix/barcodes.tsv.gz.bk <span style="color: #afaf00;">\</span>
  | gzip -d <span style="color: #afaf00;">\</span>
  | sed <span style="color: #afaf00;">"s/-1/-2/g"</span> <span style="color: #afaf00;">\</span>
  | gzip <span style="color: #afaf00;">\</span>
  &gt; ./data/heart/filtered_feature_bc_matrix/barcodes.tsv.gz

cat ./data/heart/filtered_feature_bc_matrix/barcodes.tsv.gz | gzip -d | head
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">AAACCCACACCAGTAT-2</td>
</tr>

<tr>
<td class="org-left">AAACCCAGTCACCTTC-2</td>
</tr>

<tr>
<td class="org-left">AAACCCAGTGGAACAC-2</td>
</tr>

<tr>
<td class="org-left">AAACGAAAGTGCCCGT-2</td>
</tr>

<tr>
<td class="org-left">AAACGAAGTCAGGTGA-2</td>
</tr>

<tr>
<td class="org-left">AAAGGATAGCACCGAA-2</td>
</tr>

<tr>
<td class="org-left">AAAGGATGTAACGGTG-2</td>
</tr>

<tr>
<td class="org-left">AAAGGGCAGGACGGAG-2</td>
</tr>

<tr>
<td class="org-left">AAAGTGACAGAACATA-2</td>
</tr>

<tr>
<td class="org-left">AAAGTGATCAAAGGAT-2</td>
</tr>
</tbody>
</table>

<p>
That's it! This will help when we assign labels to each cell later on.
</p>
</div>
</div>
</div>

<div id="outline-container-org0f8cd87" class="outline-2">
<h2 id="org0f8cd87">Tree creation with <code>too-many-cells</code></h2>
<div class="outline-text-2" id="text-org0f8cd87">
</div>
<div id="outline-container-org53a2bcf" class="outline-3">
<h3 id="org53a2bcf">Initial tree creation</h3>
<div class="outline-text-3" id="text-org53a2bcf">
<p>
We now have everything we need for initial runs with <code>too-many-cells</code>! Let's begin
by building a tree (ignore <code>printf</code> throughout this document, they are just
reporting the resulting file). We can specify multiple matrices to combine
automatically.
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --matrix-path ./data/brain/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --matrix-path ./data/heart/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --filter-thresholds <span style="color: #afaf00;">"(250, 1)"</span> <span style="color: #afaf00;">\</span>
  --output out <span style="color: #afaf00;">\</span>
  &gt; clusters.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/dendrogram.svg"</span>
</pre>
</div>


<div id="orgdaf26b2" class="figure">
<p><object type="image/svg+xml" data="./out/dendrogram.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>

<p>
The initial tree is built! It tells us the tree structure and the number of
cells in each leaf. Want to actually see which cells are brain and which cells
are heart? Let's give the tree some colors!
</p>
</div>
</div>
</div>

<div id="outline-container-org35c5e56" class="outline-2">
<h2 id="org35c5e56">Coloring the <code>too-many-cells</code> tree.</h2>
<div class="outline-text-2" id="text-org35c5e56">
</div>
<div id="outline-container-org931863f" class="outline-3">
<h3 id="org931863f">Prepare labels file</h3>
<div class="outline-text-3" id="text-org931863f">
<p>
We can color the tree using any label. In this case, we want to give each cell a
label based on it's celltype from the data set. Let's quickly do that.
</p>

<div class="org-src-container">
<pre class="src src-shell">gzip -d -c ./data/brain/filtered_feature_bc_matrix/barcodes.tsv.gz ./data/heart/filtered_feature_bc_matrix/barcodes.tsv.gz <span style="color: #afaf00;">\</span>
  | sed <span style="color: #afaf00;">"s/-1/-1,Brain/"</span> <span style="color: #afaf00;">\</span>
  | sed <span style="color: #afaf00;">"s/-2/-2,Heart/"</span> <span style="color: #afaf00;">\</span>
  | sed <span style="color: #afaf00;">"1i item,label"</span> <span style="color: #afaf00;">\</span>
  &gt; labels.csv

head ./labels.csv
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">item</td>
<td class="org-left">label</td>
</tr>

<tr>
<td class="org-left">AAACGAATCAAAGCCT-1</td>
<td class="org-left">Brain</td>
</tr>

<tr>
<td class="org-left">AAACGCTGTAATGTGA-1</td>
<td class="org-left">Brain</td>
</tr>

<tr>
<td class="org-left">AAACGCTGTCCTGGGT-1</td>
<td class="org-left">Brain</td>
</tr>

<tr>
<td class="org-left">AAAGAACCAGGACATG-1</td>
<td class="org-left">Brain</td>
</tr>

<tr>
<td class="org-left">AAAGGTACACACGGTC-1</td>
<td class="org-left">Brain</td>
</tr>

<tr>
<td class="org-left">AAAGTCCAGTCACTAC-1</td>
<td class="org-left">Brain</td>
</tr>

<tr>
<td class="org-left">AAAGTCCGTGACTGTT-1</td>
<td class="org-left">Brain</td>
</tr>

<tr>
<td class="org-left">AAAGTCCTCCAGCCTT-1</td>
<td class="org-left">Brain</td>
</tr>

<tr>
<td class="org-left">AAAGTGAGTTCCTAAG-1</td>
<td class="org-left">Brain</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org8e20796" class="outline-3">
<h3 id="org8e20796">Color tree</h3>
<div class="outline-text-3" id="text-org8e20796">
<p>
Great! Now we just need to feed it to <code>too-many-cells</code>. <b>Note</b>: We use <code>--prior</code>
from now on so we don't need to calculate the tree all over again. This argument
makes things much faster!
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --labels-file ./labels.csv <span style="color: #afaf00;">\</span>
  --dendrogram-output <span style="color: #afaf00;">"tree_labeled.svg"</span> <span style="color: #afaf00;">\</span>
  --output out <span style="color: #afaf00;">\</span>
  &gt; clusters.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/tree_labeled.svg"</span>
</pre>
</div>


<div id="org5c04ae2" class="figure">
<p><object type="image/svg+xml" data="./out/tree_labeled.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-org0e7eddc" class="outline-3">
<h3 id="org0e7eddc">Custom colors</h3>
<div class="outline-text-3" id="text-org0e7eddc">
<p>
We can also change the colors however we want:
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --labels-file ./labels.csv <span style="color: #afaf00;">\</span>
  --draw-colors <span style="color: #afaf00;">"[\"#66c2a5\", \"#fc8d62\"]"</span> <span style="color: #afaf00;">\</span>
  --dendrogram-output <span style="color: #afaf00;">"tree_labeled_alternate.svg"</span> <span style="color: #afaf00;">\</span>
  --output out <span style="color: #afaf00;">\</span>
  &gt; clusters.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/tree_labeled_alternate.svg"</span>
</pre>
</div>


<div id="org912f337" class="figure">
<p><object type="image/svg+xml" data="./out/tree_labeled_alternate.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgefc28f1" class="outline-2">
<h2 id="orgefc28f1">Getting more information from the tree</h2>
<div class="outline-text-2" id="text-orgefc28f1">
</div>
<div id="outline-container-org7b378e1" class="outline-3">
<h3 id="org7b378e1">Overlay modularity</h3>
<div class="outline-text-3" id="text-org7b378e1">
<p>
Now that we have a basic tree, we can start doing some quick edits. Want
modularity overlays to show the modularity at each node in the tree?
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --labels-file ./labels.csv <span style="color: #afaf00;">\</span>
  --dendrogram-output <span style="color: #afaf00;">"tree_modularity.svg"</span> <span style="color: #afaf00;">\</span>
  --draw-mark <span style="color: #afaf00;">"MarkModularity"</span> <span style="color: #afaf00;">\</span>
  --output out <span style="color: #afaf00;">\</span>
  &gt; clusters.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/tree_modularity.svg"</span>
</pre>
</div>


<div id="orga64229b" class="figure">
<p><object type="image/svg+xml" data="./out/tree_modularity.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orga67531e" class="outline-2">
<h2 id="orga67531e">Pruning the tree</h2>
<div class="outline-text-2" id="text-orga67531e">
</div>
<div id="outline-container-org6db3761" class="outline-3">
<h3 id="org6db3761">Prune tree by size</h3>
<div class="outline-text-3" id="text-org6db3761">
<p>
For a large number of cells, the tree can grow quite large. To prune the tree,
we can use different cutoffs. However, this will change the tree structure, so
be sure to output the tree in a different folder to avoid overwriting the
original tree (so we can still use <code>--prior</code>)! Let's have no leaf with less than
30 cells:
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --labels-file ./labels.csv <span style="color: #afaf00;">\</span>
  --min-size <span style="color: #d787af;">30</span> <span style="color: #afaf00;">\</span>
  --output out_pruned <span style="color: #afaf00;">\</span>
  &gt; clusters_pruned.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out_pruned/dendrogram.svg"</span>
</pre>
</div>


<div id="orge6dc117" class="figure">
<p><object type="image/svg+xml" data="./out_pruned/dendrogram.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-org5c3efd0" class="outline-3">
<h3 id="org5c3efd0">Prune tree by size distribution</h3>
<div class="outline-text-3" id="text-org5c3efd0">
<p>
Don't want arbitrary number cutoffs? Let's instead make a cutoff using the
distribution of cluster sizes. We can use <code>--smart-cutoff</code> to look at the
distribution of cluster sizes, split proportions, or distances (modularity here)
and select certain median absolute deviations (MADs) away from the median as a
cutoff. We select which feature to create a distribution by using that feature's
normal cutoff argument, where the cutoff value is ignored (so we can put 1, for
instance, as it will be ignored). Let's revise our previous attempt by cutting 1
MAD away from the median node size:
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --labels-file ./labels.csv <span style="color: #afaf00;">\</span>
  --min-size <span style="color: #d787af;">1</span> <span style="color: #afaf00;">\</span>
  --smart-cutoff <span style="color: #d787af;">1</span> <span style="color: #afaf00;">\</span>
  --dendrogram-output <span style="color: #afaf00;">"tree_smart.svg"</span> <span style="color: #afaf00;">\</span>
  --output out_pruned <span style="color: #afaf00;">\</span>
  &gt; clusters_pruned.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out_pruned/tree_smart.svg"</span>
</pre>
</div>


<div id="orgaa9658d" class="figure">
<p><object type="image/svg+xml" data="./out_pruned/tree_smart.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbe71bb6" class="outline-2">
<h2 id="orgbe71bb6">Gene expression</h2>
<div class="outline-text-2" id="text-orgbe71bb6">
</div>
<div id="outline-container-org5557f30" class="outline-3">
<h3 id="org5557f30">Neuron marker overlay</h3>
<div class="outline-text-3" id="text-org5557f30">
<p>
Want to overlay gene expression? We'll need the matrices again, but still use
<code>--prior</code> to avoid clustering. Also, we use normalization to avoid looking at
only the counts, but rather normalized counts. Let's look neuron cell marker
<i>Rbfox3</i>:
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --matrix-path ./data/brain/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --matrix-path ./data/heart/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --filter-thresholds <span style="color: #afaf00;">"(250, 1)"</span> <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --normalization <span style="color: #afaf00;">"UQNorm"</span> <span style="color: #afaf00;">\</span>
  --draw-leaf <span style="color: #afaf00;">"DrawItem (DrawContinuous [\"ENSMUSG00000025576\"])"</span> <span style="color: #afaf00;">\</span>
  --dendrogram-output <span style="color: #afaf00;">"tree_neuron.svg"</span> <span style="color: #afaf00;">\</span>
  --output out <span style="color: #afaf00;">\</span>
  &gt; clusters.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/tree_neuron.svg"</span>
</pre>
</div>


<div id="org2a578f0" class="figure">
<p><object type="image/svg+xml" data="./out/tree_neuron.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-orgabae537" class="outline-3">
<h3 id="orgabae537">Increasing visibility</h3>
<div class="outline-text-3" id="text-orgabae537">
<p>
Can't see too well? Let's up the saturation!
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --matrix-path ./data/brain/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --matrix-path ./data/heart/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --filter-thresholds <span style="color: #afaf00;">"(250, 1)"</span> <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --normalization <span style="color: #afaf00;">"UQNorm"</span> <span style="color: #afaf00;">\</span>
  --draw-leaf <span style="color: #afaf00;">"DrawItem (DrawContinuous [\"ENSMUSG00000025576\"])"</span> <span style="color: #afaf00;">\</span>
  --dendrogram-output <span style="color: #afaf00;">"tree_neuron_saturated.svg"</span> <span style="color: #afaf00;">\</span>
  --draw-scale-saturation <span style="color: #d787af;">6</span> <span style="color: #afaf00;">\</span>
  --output out <span style="color: #afaf00;">\</span>
  &gt; clusters.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/tree_neuron_saturated.svg"</span>
</pre>
</div>


<div id="org3af4f41" class="figure">
<p><object type="image/svg+xml" data="./out/tree_neuron_saturated.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-org3a211fc" class="outline-3">
<h3 id="org3a211fc">Gene symbol rather than Ensembl</h3>
<div class="outline-text-3" id="text-org3a211fc">
<p>
Want to use the gene symbol? <code>cellranger</code> provides that! Let's use that feature
column:
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --matrix-path ./data/brain/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --matrix-path ./data/heart/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --filter-thresholds <span style="color: #afaf00;">"(250, 1)"</span> <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --feature-column <span style="color: #d787af;">2</span> <span style="color: #afaf00;">\</span>
  --normalization <span style="color: #afaf00;">"UQNorm"</span> <span style="color: #afaf00;">\</span>
  --draw-leaf <span style="color: #afaf00;">"DrawItem (DrawContinuous [\"Rbfox3\"])"</span> <span style="color: #afaf00;">\</span>
  --dendrogram-output <span style="color: #afaf00;">"tree_neuron_gene_symbol.svg"</span> <span style="color: #afaf00;">\</span>
  --draw-scale-saturation <span style="color: #d787af;">6</span> <span style="color: #afaf00;">\</span>
  --output out <span style="color: #afaf00;">\</span>
  &gt; clusters.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/tree_neuron_gene_symbol.svg"</span>
</pre>
</div>


<div id="org65daabc" class="figure">
<p><object type="image/svg+xml" data="./out/tree_neuron_gene_symbol.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-org54d340d" class="outline-3">
<h3 id="org54d340d">Heart marker overlay</h3>
<div class="outline-text-3" id="text-org54d340d">
<p>
What about heart?
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --matrix-path ./data/brain/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --matrix-path ./data/heart/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --filter-thresholds <span style="color: #afaf00;">"(250, 1)"</span> <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --feature-column <span style="color: #d787af;">2</span> <span style="color: #afaf00;">\</span>
  --normalization <span style="color: #afaf00;">"UQNorm"</span> <span style="color: #afaf00;">\</span>
  --draw-leaf <span style="color: #afaf00;">"DrawItem (DrawContinuous [\"Gata6\"])"</span> <span style="color: #afaf00;">\</span>
  --dendrogram-output <span style="color: #afaf00;">"tree_heart.svg"</span> <span style="color: #afaf00;">\</span>
  --draw-scale-saturation <span style="color: #d787af;">6</span> <span style="color: #afaf00;">\</span>
  --output out <span style="color: #afaf00;">\</span>
  &gt; clusters.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/tree_heart.svg"</span>
</pre>
</div>


<div id="orgbc34e1a" class="figure">
<p><object type="image/svg+xml" data="./out/tree_heart.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-orga0507ff" class="outline-3">
<h3 id="orga0507ff">Multiple gene expression overlays</h3>
<div class="outline-text-3" id="text-orga0507ff">
<p>
What about <b>both</b>!?
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --matrix-path ./data/brain/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --matrix-path ./data/heart/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --filter-thresholds <span style="color: #afaf00;">"(250, 1)"</span> <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --feature-column <span style="color: #d787af;">2</span> <span style="color: #afaf00;">\</span>
  --normalization <span style="color: #afaf00;">"UQNorm"</span> <span style="color: #afaf00;">\</span>
  --draw-leaf <span style="color: #afaf00;">"DrawItem (DrawThresholdContinuous [(\"Rbfox3\", Exact 0), (\"Gata6\", Exact 0)])"</span> <span style="color: #afaf00;">\</span>
  --dendrogram-output <span style="color: #afaf00;">"tree_brain_heart_markers.svg"</span> <span style="color: #afaf00;">\</span>
  --output out <span style="color: #afaf00;">\</span>
  &gt; clusters.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/tree_brain_heart_markers.svg"</span>
</pre>
</div>


<div id="org2936779" class="figure">
<p><object type="image/svg+xml" data="./out/tree_brain_heart_markers.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-org620b908" class="outline-3">
<h3 id="org620b908">Custom colors for multiple expression overlays</h3>
<div class="outline-text-3" id="text-org620b908">
<p>
Now we can see a more complete picture! But this is combinatorial in the number
of features with high and low, can we focus in on a few? The order is always
alphabetical, so we can assign our own colors &#x2013; ones that don't get saturated
for unimportant cases!
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --matrix-path ./data/brain/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --matrix-path ./data/heart/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --filter-thresholds <span style="color: #afaf00;">"(250, 1)"</span> <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --feature-column <span style="color: #d787af;">2</span> <span style="color: #afaf00;">\</span>
  --normalization <span style="color: #afaf00;">"UQNorm"</span> <span style="color: #afaf00;">\</span>
  --draw-leaf <span style="color: #afaf00;">"DrawItem (DrawThresholdContinuous [(\"Rbfox3\", Exact 0), (\"Gata6\", Exact 0)])"</span> <span style="color: #afaf00;">\</span>
  --dendrogram-output <span style="color: #afaf00;">"tree_brain_heart_markers_alternate.svg"</span> <span style="color: #afaf00;">\</span>
  --draw-colors <span style="color: #afaf00;">"[\"#e41a1c\", \"#377eb8\", \"#4daf4a\", \"#999999\"]"</span> <span style="color: #afaf00;">\</span>
  --draw-scale-saturation <span style="color: #d787af;">6</span> <span style="color: #afaf00;">\</span>
  --output out <span style="color: #afaf00;">\</span>
  &gt; clusters.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/tree_brain_heart_markers_alternate.svg"</span>
</pre>
</div>


<div id="org0cc9175" class="figure">
<p><object type="image/svg+xml" data="./out/tree_brain_heart_markers_alternate.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org9e14968" class="outline-2">
<h2 id="org9e14968">Differential expression</h2>
<div class="outline-text-2" id="text-org9e14968">
</div>
<div id="outline-container-org0c9a4af" class="outline-3">
<h3 id="org0c9a4af">Overlay node numbers</h3>
<div class="outline-text-3" id="text-org0c9a4af">
<p>
Now that we've seen some expressions, we quantify the differences in
expressions between populations using the <code>differential</code> entry point. First,
which node is which? Let's overlay their node IDs.
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells make-tree <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --labels-file ./labels.csv <span style="color: #afaf00;">\</span>
  --draw-node-number <span style="color: #afaf00;">\</span>
  --dendrogram-output <span style="color: #afaf00;">"tree_numbers.svg"</span> <span style="color: #afaf00;">\</span>
  --output out <span style="color: #afaf00;">\</span>
  &gt; clusters.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/tree_numbers.svg"</span>
</pre>
</div>


<div id="orgcdb137c" class="figure">
<p><object type="image/svg+xml" data="./out/tree_numbers.svg" class="org-svg">
Sorry, your browser does not support SVG.</object>
</p>
</div>
</div>
</div>

<div id="outline-container-org5756f7d" class="outline-3">
<h3 id="org5756f7d">Differential expression for two nodes</h3>
<div class="outline-text-3" id="text-org5756f7d">
<p>
We know that <code>Gata6</code> is higher in node 94 versus 121. Let's look at the
differential expression of 94 / 121.
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells differential <span style="color: #afaf00;">\</span>
  --matrix-path ./data/brain/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --matrix-path ./data/heart/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --filter-thresholds <span style="color: #afaf00;">"(250, 1)"</span> <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --nodes <span style="color: #afaf00;">"([121], [94])"</span> <span style="color: #afaf00;">\</span>
  &gt; ./out/94_vs_121.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/94_vs_121.csv"</span>
</pre>
</div>

<p>
<a href="./out/94_vs_121.csv">./out/94_vs_121.csv</a>
</p>
</div>
</div>

<div id="outline-container-org0372f11" class="outline-3">
<h3 id="org0372f11">Differential expression for two groups of nodes</h3>
<div class="outline-text-3" id="text-org0372f11">
<p>
Why does the format have brackets? Because it's a list! We can compare
multiple nodes to each other:
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells differential <span style="color: #afaf00;">\</span>
  --matrix-path ./data/brain/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --matrix-path ./data/heart/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --filter-thresholds <span style="color: #afaf00;">"(250, 1)"</span> <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --feature-column <span style="color: #d787af;">2</span> <span style="color: #afaf00;">\</span>
  --normalization <span style="color: #afaf00;">"UQNorm"</span> <span style="color: #afaf00;">\</span>
  --nodes <span style="color: #afaf00;">"([121], [94, 5])"</span> <span style="color: #afaf00;">\</span>
  &gt; ./out/94_5_vs_121.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/94_5_vs_121.csv"</span>
</pre>
</div>

<p>
<a href="./out/94_5_vs_121.csv">./out/94_5_vs_121.csv</a>
</p>
</div>
</div>

<div id="outline-container-orgd23bf2f" class="outline-3">
<h3 id="orgd23bf2f">Label-filtered differential expression</h3>
<div class="outline-text-3" id="text-orgd23bf2f">
<p>
There's some nodes with multiple celltypes in them &#x2013; can we compare just
the brain cells to heart cells in their "respective" cluster?
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells differential <span style="color: #afaf00;">\</span>
  --matrix-path ./data/brain/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --matrix-path ./data/heart/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --filter-thresholds <span style="color: #afaf00;">"(250, 1)"</span> <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --labels-file ./labels.csv <span style="color: #afaf00;">\</span>
  --feature-column <span style="color: #d787af;">2</span> <span style="color: #afaf00;">\</span>
  --normalization <span style="color: #afaf00;">"UQNorm"</span> <span style="color: #afaf00;">\</span>
  --nodes <span style="color: #afaf00;">"([121], [94, 5])"</span> <span style="color: #afaf00;">\</span>
  --labels <span style="color: #afaf00;">"([\"Brain\"], [\"Heart\"])"</span> <span style="color: #afaf00;">\</span>
  &gt; ./out/94_5_vs_121_filtered.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/94_5_vs_121_filtered.csv"</span>
</pre>
</div>

<p>
<a href="./out/94_5_vs_121_filtered.csv">./out/94_5_vs_121_filtered.csv</a>
</p>
</div>
</div>

<div id="outline-container-org44ad1cc" class="outline-3">
<h3 id="org44ad1cc">Gene distribution plots</h3>
<div class="outline-text-3" id="text-org44ad1cc">
<p>
We can do some basic plotting as well for specific genes, such as <code>Gata6</code> and
<code>Rbfox3</code> here.
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells differential <span style="color: #afaf00;">\</span>
  --matrix-path ./data/brain/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --matrix-path ./data/heart/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --filter-thresholds <span style="color: #afaf00;">"(250, 1)"</span> <span style="color: #afaf00;">\</span>
  --labels-file ./labels.csv <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --feature-column <span style="color: #d787af;">2</span> <span style="color: #afaf00;">\</span>
  --normalization <span style="color: #afaf00;">"UQNorm"</span> <span style="color: #afaf00;">\</span>
  --nodes <span style="color: #afaf00;">"([121], [94, 5])"</span> <span style="color: #afaf00;">\</span>
  --labels <span style="color: #afaf00;">"([\"Brain\"], [\"Heart\"])"</span> <span style="color: #afaf00;">\</span>
  --features <span style="color: #afaf00;">"Gata6"</span> <span style="color: #afaf00;">\</span>
  --features <span style="color: #afaf00;">"Rbfox3"</span> <span style="color: #afaf00;">\</span>
  --plot-output <span style="color: #afaf00;">"./out/genes.pdf"</span>

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/genes.pdf"</span>
</pre>
</div>

<p>
<a href="./out/genes.pdf">./out/genes.pdf</a>
</p>
</div>
</div>

<div id="outline-container-orga57d425" class="outline-3">
<h3 id="orga57d425">All to all!</h3>
<div class="outline-text-3" id="text-orga57d425">
<p>
Last, but not least, we can get the differential genes for every node versus all
other nodes by not specifying any nodes at all. Useful for quick gene enrichment
analyses!
</p>

<div class="org-src-container">
<pre class="src src-shell">too-many-cells differential <span style="color: #afaf00;">\</span>
  --matrix-path ./data/brain/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --matrix-path ./data/heart/filtered_feature_bc_matrix/ <span style="color: #afaf00;">\</span>
  --filter-thresholds <span style="color: #afaf00;">"(250, 1)"</span> <span style="color: #afaf00;">\</span>
  --prior out <span style="color: #afaf00;">\</span>
  --feature-column <span style="color: #d787af;">2</span> <span style="color: #afaf00;">\</span>
  --normalization <span style="color: #afaf00;">"UQNorm"</span> <span style="color: #afaf00;">\</span>
  --nodes <span style="color: #afaf00;">"([], [])"</span> <span style="color: #afaf00;">\</span>
  &gt; ./out/all_nodes_differential.csv

<span style="color: #ff8700;">printf</span> <span style="color: #afaf00;">"./out/all_nodes_differential.csv"</span>
</pre>
</div>

<p>
<a href="./out/all_nodes_differential.csv">./out/all_nodes_differential.csv</a>
</p>
</div>
</div>

<div id="outline-container-orgbac3614" class="outline-3">
<h3 id="orgbac3614">More to discover</h3>
<div class="outline-text-3" id="text-orgbac3614">
<p>
We've only scratched the surface here, for many more customizable options, check
out the help documentation for each entry point, e.g. <code>too-many-cells make-tree
-h</code>.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Gregory W. Schwartz</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
